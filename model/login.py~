import openid
from openid.consumer.consumer import Consumer
from openid.consumer.discover import DiscoveryFailure
from openid.store.interface import OpenIDStore
from yadis import xri
import time
from datetime import datetime
import httplib
import urllib2
import consumer

def new_user(db, name, designation, team, dob, joining, addr):
  dob = datetime.strptime(dob, '%d/%m/%Y')
  joining = datetime.strptime(joining, '%d/%m/%Y')
  
  return db.execute("insert into users (name, designation, team, dob, joined_on, address) values (%s, %s, %s, %s, %s, %s)", name, designation, team, dob, joining, addr)

def get_all_users(db):
  return db.query("select * from users where deleted = 0")

def user_login(request):
  consumer = Consumer(request, OpenIDStore())
  try:
    auth_request = consumer.begin("https://www.google.com/accounts/o8/id")
  except DiscoveryFailure:
    print 'The OpenID was invalid'


if __name__ == "__main__":
  login(urllib2.Request("https://www.google.com/accounts/o8/id"))
  consumer = consumer.Consumer(Session, None)
